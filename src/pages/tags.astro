---
import { fetchPosts } from '~/utils/blog';
import Layout from '~/layouts/PageLayout.astro';

const posts = await fetchPosts();
const tagsMap = new Map();

posts.forEach(post => {
  post.tags?.forEach(tag => {
    const existing = tagsMap.get(tag.slug) || { ...tag, count: 0 };
    existing.count++;
    tagsMap.set(tag.slug, existing);
  });
});

const tags = Array.from(tagsMap.values())
  .sort((a, b) => b.count - a.count);

const metadata = {
  title: '文章标签',
  description: `本站共有 ${tags.length} 个标签`,
};
---

<Layout metadata={metadata}>
  <section class="px-4 md:px-6 py-12 sm:py-16 lg:py-20 mx-auto max-w-4xl">
    <h1 class="text-3xl font-bold mb-8">标签</h1>
    
    <div class="flex flex-wrap gap-3">
      {tags.map(tag => (
        <a 
          href={`/tag/${tag.slug}/`}
          class="px-4 py-2 bg-gray-100 hover:bg-blue-100 text-gray-700 hover:text-blue-700 rounded-full text-sm transition-colors"
          style={`font-size: ${Math.max(0.875, Math.min(1.25, 0.875 + tag.count * 0.05))}rem`}
        >
          {tag.title} ({tag.count})
        </a>
      ))}
    </div>
  </section>
</Layout>