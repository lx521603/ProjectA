---
import type { GetStaticProps } from 'astro';
import { fetchPosts, getStaticPathsBlogCategory } from '~/utils/blog';
import Layout from '~/layouts/PageLayout.astro';

export const prerender = true;

const posts = await fetchPosts();
const categoriesMap = new Map();

posts.forEach(post => {
  if (post.category) {
    const existing = categoriesMap.get(post.category.slug) || { 
      ...post.category, 
      count: 0 
    };
    existing.count++;
    categoriesMap.set(post.category.slug, existing);
  }
});

const categories = Array.from(categoriesMap.values())
  .sort((a, b) => b.count - a.count);

const metadata = {
  title: '文章分类',
  description: `本站共有 ${categories.length} 个分类主题`,
};
---

<Layout metadata={metadata}>
  <section class="px-4 md:px-6 py-12 sm:py-16 lg:py-20 mx-auto max-w-4xl">
    <h1 class="text-3xl font-bold mb-8">文章分类</h1>
    <p class="text-gray-600 mb-12">共 {categories.length} 个分类</p>
    
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {categories.map(category => (
        <a 
          href={`/category/${category.slug}/`}
          class="block p-6 border border-gray-200 rounded-lg hover:border-blue-500 hover:shadow-md transition-all"
        >
          <h3 class="text-xl font-semibold mb-2">{category.title}</h3>
          <p class="text-gray-600 text-sm">{category.count} 篇文章</p>
        </a>
      ))}
    </div>
  </section>
</Layout>